<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crescendo</title>
      <!-- Our stylesheet -->
      <link rel="stylesheet" type="text/css" href="/index.css">
</head>
<body>
  <form>

<div class="container">
<h1>Register</h1>
<p id="fill">Please fill in this form to create an account</p>
<hr>

<label for="email"><b>Email</b></label>
<input type="text" placeholder="Enter Email" name="email" id="email" required>

<label for="Password"><b>Password</b></label>
<input type="text" placeholder="Password" name="psw" id="psw" required>

<hr> 
<p>By creating an account agree to our <a href='#'>Terms & Privacy</a>.</p>

<button type="button" id="submitData" name="submitData" class="registerbtn">Register</button>
</div>

<div class="container signin">
  <p>Already have an account? <a href='./signin.html'>Sign in</a>.</p>
</div>
  </form>

    <!----Javascript for login-->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-app.js";
      import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-auth.js";
      import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-database.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.9.2/firebase-analytics.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyBU3LepW_SUwprnYO3WJx9J5J85tFm7iZM",
        authDomain: "crescendo-authentification.firebaseapp.com",
        databaseURL: "https://crescendo-authentification-default-rtdb.firebaseio.com",
        projectId: "crescendo-authentification",
        storageBucket: "crescendo-authentification.appspot.com",
        messagingSenderId: "252335015987",
        appId: "1:252335015987:web:188683f5de5d51a8b7bb46",
        measurementId: "G-TM0NF9F38S"
      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);
      const auth = getAuth();
      const analytics = getAnalytics(app);

      submitData.addEventListener('click', (e) => {

var email = document.getElementById('email').value;
var password = document.getElementById('psw').value;


        createUserWithEmailAndPassword(auth, email, password)
  .then((userCredential) => {
    // Signed in 
    const user = userCredential.user;
    // ... user.uid

    set(ref(database, 'users/' + user.uid), {
    email: email,
    password: password

  })
  .then(() => {
  // Data saved successfully!
  alert('user created successfully!');
})
.catch((error) => {
  // The write failed...
  alert(error);
});

  })
  .catch((error) => {
    const errorCode = error.code;
    const errorMessage = error.message;
    // ..

    alert('errorMessage');
  });

  /////////////////////////////////////////////////////////////////////
  signInWithEmailAndPassword(auth, email, password)
  .then((userCredential) => {
    // Signed in 
    const user = userCredential.user;
    // ...
var lgDate = new Date();
    update(ref(database, 'users/' + user.uid), {
  last_login: lgDate,

  })
  .then(() => {
  // Data saved successfully!
  alert('user logged in successfully!');
})
.catch((error) => {
  // The write failed...
  alert(error);
});
  })
  .catch((error) => {
    const errorCode = error.code;
    const errorMessage = error.message;

alert(errorMessage);

  });
      });

signOut(auth).then(()=>{
  //sign out successfully
}).catch((error)=>{
  //an error happened.
});

    </script>
  
</body>



<!--Javascript -->
<script src="/index.js"></script>
</html>